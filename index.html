<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laporan Kokurikulum SKSP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        body { font-family: 'Roboto', sans-serif; background: #f0fdf4; }

        /* DASHBOARD (Mobile Friendly) */
        .dashboard-card { background: white; border-top: 5px solid #047857; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        input, select { border: 1px solid #d1d5db; }
        input:focus, select:focus { outline: 2px solid #059669; }
        .caps { text-transform: uppercase; }

        /* --- PDF CONTAINER (FIXED A4 PIXELS) --- */
        /* A4 Width at 96DPI = approx 794px.
           Height = approx 1123px.
           Kita paksa lebar ini supaya tak lari di mobile.
        */
        .hidden-report {
            position: fixed;
            top: 0; left: 0;
            z-index: -9999;
            width: 794px; /* LEBAR TETAP A4 */
            min-height: 1122px;
            background: white;
            visibility: hidden;
        }

        #pdf-content {
            width: 100%;
            padding: 40px 50px; /* Margin Dalam (Padding) */
            box-sizing: border-box;
            color: black;
            font-family: Arial, sans-serif;
            font-size: 14px; /* Saiz font standard dokumen */
            line-height: 1.3;
        }

        /* PDF ELEMENTS STYLING */
        .header-pdf { text-align: center; border-bottom: 2px solid black; padding-bottom: 10px; margin-bottom: 20px; }
        .header-pdf img { height: 80px; margin-bottom: 5px; }
        .header-pdf h2 { margin: 0; font-size: 18px; font-weight: bold; }
        .header-pdf h3 { margin: 0; font-size: 16px; font-weight: bold; }

        .tbl-pdf { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        .tbl-pdf td { border: 1px solid black; padding: 5px 8px; vertical-align: top; }
        .tbl-label { background-color: #f3f4f6; font-weight: bold; width: 30%; }

        .section-title { font-weight: bold; text-decoration: underline; margin-bottom: 5px; font-size: 14px; }
        
        .img-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .img-box { 
            height: 150px; /* Tinggi Tetap Gambar */
            border: 1px solid #999; 
            display: flex; align-items: center; justify-content: center; 
            background: #f9fafb; overflow: hidden; 
        }
        .img-box img { width: 100%; height: 100%; object-fit: cover; }

        .footer-sign { margin-top: 30px; }
        .line-sign { border-top: 1px solid black; width: 250px; margin-top: 50px; padding-top: 5px; }
    </style>
</head>
<body class="p-4">

    <div class="max-w-3xl mx-auto dashboard-card rounded-lg p-6">
        <div class="text-center mb-6">
            <img src="https://i.ibb.co/xKSj5N9w/Logo-SKSP-01.png" class="h-16 mx-auto mb-2">
            <h1 class="text-xl font-bold text-emerald-800">SISTEM LAPORAN KOKURIKULUM</h1>
            <p class="text-sm text-gray-500">SK SERI PULEH</p>
        </div>

        <form id="formLaporan" class="space-y-4">
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="text-xs font-bold text-gray-700">Tahun</label>
                    <select id="tahun" class="w-full p-2 rounded text-sm bg-gray-50"><option>2026</option><option>2027</option><option>2028</option><option>2029</option><option>2030</option></select>
                </div>
                <div>
                    <label class="text-xs font-bold text-gray-700">Kategori</label>
                    <select id="jenis" class="w-full p-2 rounded text-sm bg-gray-50" onchange="updateUnits()">
                        <option value="LAPORAN UNIT BERUNIFORM">UNIT BERUNIFORM</option>
                        <option value="LAPORAN RUMAH SUKAN">RUMAH SUKAN</option>
                        <option value="LAPORAN KELAB & PERSATUAN">KELAB & PERSATUAN</option>
                        <option value="LAPORAN SUKAN & PERMAINAN">SUKAN & PERMAINAN</option>
                    </select>
                </div>
            </div>

            <div>
                <label class="text-xs font-bold text-gray-700">Nama Unit</label>
                <input type="text" id="unit" list="list_unit" class="caps w-full p-2 rounded text-sm bg-gray-50" placeholder="Pilih unit..." required>
                <datalist id="list_unit"></datalist>
            </div>

            <div class="grid grid-cols-3 gap-2">
                <div><label class="text-xs font-bold text-gray-700">Tarikh</label><input type="date" id="tarikh" class="w-full p-2 rounded text-sm"></div>
                <div><label class="text-xs font-bold text-gray-700">Masa Mula</label><input type="time" id="mula" class="w-full p-2 rounded text-sm"></div>
                <div><label class="text-xs font-bold text-gray-700">Masa Tamat</label><input type="time" id="tamat" class="w-full p-2 rounded text-sm"></div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div><label class="text-xs font-bold text-gray-700">Tempat</label><input type="text" id="tempat" class="caps w-full p-2 rounded text-sm"></div>
                <div>
                    <label class="text-xs font-bold text-gray-700">Kehadiran</label>
                    <div class="flex gap-1">
                        <input type="number" id="hadir" class="w-full p-2 rounded text-sm" placeholder="Hadir">
                        <input type="number" id="penuh" class="w-full p-2 rounded text-sm" placeholder="Penuh">
                    </div>
                </div>
            </div>

            <div class="bg-gray-50 p-2 rounded border">
                <label class="text-xs font-bold text-emerald-800">Guru Penasihat</label>
                <div id="guru_box" class="mt-1 space-y-2">
                    <div class="flex gap-1">
                        <input type="text" list="list_guru" class="inp-guru caps w-full p-2 rounded text-sm border" placeholder="Nama Guru">
                        <button type="button" onclick="addGuru()" class="bg-emerald-600 text-white px-3 rounded">+</button>
                    </div>
                </div>
                <datalist id="list_guru"></datalist>
            </div>

            <div>
                <label class="text-xs font-bold text-gray-700">Aktiviti (Wajib 4)</label>
                <div class="space-y-1 mt-1">
                    <input type="text" id="a1" class="w-full p-2 rounded text-sm border" placeholder="1.">
                    <input type="text" id="a2" class="w-full p-2 rounded text-sm border" placeholder="2.">
                    <input type="text" id="a3" class="w-full p-2 rounded text-sm border" placeholder="3.">
                    <input type="text" id="a4" class="w-full p-2 rounded text-sm border" placeholder="4.">
                </div>
            </div>

            <div>
                <label class="text-xs font-bold text-gray-700">Gambar (Max 3)</label>
                <div class="grid grid-cols-3 gap-2 mt-1">
                    <input type="file" accept="image/*" onchange="loadImg(this,0)" class="text-xs">
                    <input type="file" accept="image/*" onchange="loadImg(this,1)" class="text-xs">
                    <input type="file" accept="image/*" onchange="loadImg(this,2)" class="text-xs">
                </div>
            </div>

            <div>
                <label class="text-xs font-bold text-gray-700">Disediakan Oleh</label>
                <input type="text" id="penyedia" list="list_guru" class="caps w-full p-2 rounded text-sm">
            </div>

            <button type="button" onclick="makePDF()" class="w-full bg-emerald-700 text-white font-bold py-3 rounded shadow hover:bg-emerald-800 mt-2">
                JANA PDF (A4 FIT)
            </button>
        </form>
    </div>

    <div class="hidden-report">
        <div id="pdf-content">
            <div class="header-pdf">
                <img src="https://i.ibb.co/xKSj5N9w/Logo-SKSP-01.png">
                <h2>SEKOLAH KEBANGSAAN SERI PULEH</h2>
                <h3 id="p_jenis">LAPORAN AKTIVITI KOKURIKULUM</h3>
            </div>

            <table class="tbl-pdf">
                <tr><td class="tbl-label">TAHUN</td><td id="p_tahun"></td></tr>
                <tr><td class="tbl-label">UNIT / KELAB</td><td id="p_unit" style="font-weight:bold;"></td></tr>
                <tr><td class="tbl-label">TARIKH / MASA</td><td id="p_tarikh"></td></tr>
                <tr><td class="tbl-label">TEMPAT</td><td id="p_tempat"></td></tr>
                <tr><td class="tbl-label">KEHADIRAN</td><td id="p_hadir"></td></tr>
                <tr><td class="tbl-label">GURU PENASIHAT</td><td id="p_guru"></td></tr>
            </table>

            <div style="margin-bottom: 20px;">
                <div class="section-title">RINGKASAN AKTIVITI:</div>
                <div style="padding-left: 5px;">
                    <div id="p_a1"></div><div id="p_a2"></div><div id="p_a3"></div><div id="p_a4"></div>
                </div>
            </div>

            <div>
                <div style="text-align:center; background:#eee; padding:3px; font-weight:bold; margin-bottom:5px; border:1px solid #000;">GAMBAR AKTIVITI</div>
                <div class="img-grid" id="p_img_container">
                    </div>
            </div>

            <div class="footer-sign">
                <p>Disediakan oleh,</p>
                <div class="line-sign">
                    <p style="font-weight:bold; margin:0;" id="p_penyedia"></p>
                    <p style="margin:0;">Guru Penasihat</p>
                    <p style="margin:0; font-weight:bold;" id="p_unit_bawah"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // DATA
        const dbUnit = {
            "LAPORAN UNIT BERUNIFORM": ["PERSEKUTUAN PENGAKAP MALAYSIA (PENGAKAP KANAK-KANAK)", "PERSEKUTUAN PENGAKAP MALAYSIA (PENGAKAP KANAK-KANAK PPKI)", "TUNAS KADET REMAJA", "PERGERAKAN PUTERI ISLAM MALAYSIA"],
            "LAPORAN RUMAH SUKAN": ["RUMAH BUANA", "RUMAH SURIA", "RUMAH PURNAMA", "RUMAH SEGARA"],
            "LAPORAN KELAB & PERSATUAN": ["PERSATUAN BAHASA", "PERSATUAN STEM", "PERSATUAN AGAMA ISLAM DAN BAHASA ARAB", "KELAB DOKTOR MUDA", "KELAB SENI TARI", "KELAB MEDIA", "KELAB PERTANIAN PPKI"],
            "LAPORAN SUKAN & PERMAINAN": ["KELAB BOLA SEPAK", "KELAB BOLA JARING", "KELAB BADMINTON", "KELAB CATUR", "KELAB SEPAK TAKRAW", "KELAB BOLING PADANG PPKI"]
        };
        const dbGuru = ["SARDI BIN HASSHIM", "AYU SARAH BINTI ABDULLAH", "MASKOR BIN OSMAN", "ARNIZA BINTI ATAN", "MUHAMMAD AIMAN SYAFIQ BIN ABDUL RAHMAN", "HANAPIAH BINTI TAHERAN", "RINI BINTI YUNUS", "HAZLEYN BT. RAHMAT", "SITI NOR FAZIDAH BINTI TAHIR", "MUHD RIDHWAN BIN SANDONG", "AHMAD HAWAZAN BIN KHOILED", "NUR FARIHIN BINTI MUHAMAD YUSOF", "SHARIFAH BINTI KATMIN", "AMAR ARIFF BIN MOHAMAD HATTA", "ASPRINAH BINTI ABU", "SHAHROM BIN SUKINI", "KAMARUL ARIFFIN BIN RAHMAT", "NOR AISAH BINTI JAIS", "SITI FATIMAH BINTI BAHAR", "SITI NURWAFIYZA BINTI MASRUKIN", "VILMA FARHA BINTI MD AFFINDI", "HIDAYATI BINTI MARNO @ MOHD NOR", "FATIMAH BINTI MASRAN", "SAMIAH BINTI SEKAN", "FATIN ATHIRAH BINTI MAT YUSOFF", "MOHD ROFIZEN BIN IBRAHIM", "MUHAMMAD RAJIE BIN MAHADI", "MOHAMAD KHAIRUL ANUAR BIN MOHD YUSOF", "RAHAYU BINTI MOHD JALIL", "ZAHARIAH BINTI SAMADUN", "NAZIHAH IZYAN BINTI AYUB", "NURAZIAH BINTI BAHROM", "MUHAMMAD HAMIZI BIN MOHD SAID", "MOHD.NAZID BIN HARON", "MASITAH BINTI MEOR HUSSIN", "NOR ASHIKIN BINTI RAMLI", "ZAILATI BT ALI", "NOOR HAZURA BINTI HAMDAN", "SITI RIFA BINTI MOHD SAIM"];

        // INIT
        const listGuru = document.getElementById('list_guru');
        dbGuru.forEach(g => listGuru.innerHTML += `<option value="${g}">`);
        updateUnits();

        function updateUnits(){
            const cat = document.getElementById('jenis').value;
            const list = document.getElementById('list_unit');
            list.innerHTML = "";
            document.getElementById('unit').value = "";
            if(dbUnit[cat]) dbUnit[cat].forEach(u => list.innerHTML += `<option value="${u}">`);
        }

        let rawImgs = [null, null, null];
        function loadImg(el, i){
            if(el.files[0]){
                const r = new FileReader();
                r.onload = e => rawImgs[i] = e.target.result;
                r.readAsDataURL(el.files[0]);
            }
        }

        function addGuru(){
            const div = document.createElement('div');
            div.className = "flex gap-1";
            div.innerHTML = `<input type="text" list="list_guru" class="inp-guru caps w-full p-2 rounded text-sm border"><button type="button" onclick="this.parentElement.remove()" class="bg-red-500 text-white px-3 rounded">-</button>`;
            document.getElementById('guru_box').appendChild(div);
        }

        function makePDF(){
            const unitVal = document.getElementById('unit').value.toUpperCase();
            if(!unitVal) return alert("Sila isi Nama Unit!");

            // 1. ISI DATA KE TEMPLATE
            document.getElementById('p_tahun').innerText = document.getElementById('tahun').value;
            document.getElementById('p_jenis').innerText = document.getElementById('jenis').value;
            document.getElementById('p_unit').innerText = unitVal;
            
            const tm = document.getElementById('mula').value;
            const tt = document.getElementById('tamat').value;
            document.getElementById('p_tarikh').innerText = `${document.getElementById('tarikh').value}  (${tm} - ${tt})`;
            document.getElementById('p_tempat').innerText = document.getElementById('tempat').value.toUpperCase();
            document.getElementById('p_hadir').innerText = `${document.getElementById('hadir').value} / ${document.getElementById('penuh').value}`;
            
            let gs = [];
            document.querySelectorAll('.inp-guru').forEach(i => { if(i.value) gs.push(i.value) });
            document.getElementById('p_guru').innerText = gs.join(", ");

            document.getElementById('p_a1').innerText = "1. " + document.getElementById('a1').value;
            document.getElementById('p_a2').innerText = "2. " + document.getElementById('a2').value;
            document.getElementById('p_a3').innerText = "3. " + document.getElementById('a3').value;
            document.getElementById('p_a4').innerText = "4. " + document.getElementById('a4').value;
            
            document.getElementById('p_penyedia').innerText = document.getElementById('penyedia').value.toUpperCase();
            document.getElementById('p_unit_bawah').innerText = unitVal;

            const imgBox = document.getElementById('p_img_container');
            imgBox.innerHTML = "";
            rawImgs.forEach(src => {
                let d = document.createElement('div');
                d.className = "img-box";
                d.innerHTML = src ? `<img src="${src}">` : `<span style='color:#ccc'>TIADA GAMBAR</span>`;
                imgBox.appendChild(d);
            });

            // 2. JANA PDF
            const element = document.getElementById('pdf-content');
            
            // PENTING: Tunjuk sekejap untuk render
            document.querySelector('.hidden-report').style.visibility = 'visible';
            
            const opt = {
                margin: 0, // KITA GUNA PADDING CSS
                filename: `Laporan_${unitVal.replace(/\s/g,'_')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true, scrollY: 0 },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                document.querySelector('.hidden-report').style.visibility = 'hidden';
            });
        }
    </script>
</body>
</html>
