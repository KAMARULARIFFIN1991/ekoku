<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Laporan Kokurikulum SKSP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
        body { background: #f0fdf4; font-family: 'Roboto', sans-serif; }

        /* DASHBOARD */
        .dashboard-card { background: white; border-top: 5px solid #047857; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input, select { border: 1px solid #ccc; }
        .caps { text-transform: uppercase; }

        /* --- PDF STYLING (VERSI RAPAT & PADAT) --- */
        
        /* Container Ghaib - Paksa Lebar Desktop */
        .hidden-container {
            position: fixed;
            top: 0; left: 0;
            z-index: -9999;
            width: 800px; /* Paksa lebar pixel tetap */
            height: auto;
            visibility: hidden;
            background: white;
        }

        #pdf-content {
            width: 100%;
            /* Margin sangat minima untuk jimat ruang */
            padding: 5mm 15mm; 
            box-sizing: border-box;
            color: #000;
            line-height: 1.1; /* Jarak baris dirapatkan */
            font-family: Arial, sans-serif;
        }

        /* Header */
        table.header-table { width: 100%; border-bottom: 2px solid black; margin-bottom: 5px; }
        .header-text h2 { margin: 0; font-size: 14pt; font-weight: bold; }
        .header-text h3 { margin: 0; font-size: 11pt; font-weight: bold; margin-top: 2px; }

        /* Info Table */
        table.info-table { width: 100%; border-collapse: collapse; font-size: 9.5pt; }
        table.info-table td { border: 1px solid #000; padding: 3px 5px; vertical-align: top; } /* Padding dikurangkan */
        .bg-gray { background-color: #f0f0f0; font-weight: bold; width: 28%; }

        /* Aktiviti */
        .section-title { font-weight: bold; font-size: 10pt; border-bottom: 1px solid black; margin-top: 10px; display: inline-block; }
        table.act-table { width: 100%; font-size: 9.5pt; margin-top: 2px; }
        table.act-table td { padding: 1px 0; }

        /* Gambar - DIKECILKAN */
        .img-header { margin-top: 10px; text-align: center; background: #eee; border: 1px solid #000; font-weight: bold; font-size: 9pt; padding: 2px; }
        table.img-table { width: 100%; border-collapse: collapse; margin-top: 0px; }
        table.img-table td { 
            width: 33.33%; 
            height: 120px; /* Tinggi gambar dikurangkan ke 120px */
            border: 1px solid #999; 
            text-align: center; 
            vertical-align: middle; 
            padding: 0;
            background: #f9f9f9;
        }
        table.img-table img { width: 100%; height: 120px; object-fit: cover; display: block; }

        /* Footer */
        .footer-div { margin-top: 15px; font-size: 9.5pt; }
        .sign-box { border-top: 1px solid #000; width: 220px; margin-top: 35px; padding-top: 2px; }

    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-3xl mx-auto dashboard-card rounded-lg p-6">
        <div class="text-center mb-6">
            <img src="https://i.ibb.co/xKSj5N9w/Logo-SKSP-01.png" class="h-20 mx-auto mb-2">
            <h1 class="text-xl font-bold text-emerald-800">SISTEM LAPORAN KOKURIKULUM</h1>
            <p class="text-sm text-gray-600">SK SERI PULEH</p>
        </div>

        <form id="formKoku" class="space-y-3">
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="block text-xs font-bold text-gray-700">Tahun</label>
                    <select id="tahun" class="w-full p-2 text-sm rounded"><option>2026</option><option>2027</option><option>2028</option><option>2029</option><option>2030</option></select>
                </div>
                <div>
                    <label class="block text-xs font-bold text-gray-700">Kategori</label>
                    <select id="jenis" class="w-full p-2 text-sm rounded" onchange="updateUnits()">
                        <option value="LAPORAN UNIT BERUNIFORM">UNIT BERUNIFORM</option>
                        <option value="LAPORAN RUMAH SUKAN">RUMAH SUKAN</option>
                        <option value="LAPORAN KELAB & PERSATUAN">KELAB & PERSATUAN</option>
                        <option value="LAPORAN SUKAN & PERMAINAN">SUKAN & PERMAINAN</option>
                    </select>
                </div>
            </div>

            <div>
                <label class="block text-xs font-bold text-gray-700">Nama Unit</label>
                <input type="text" id="unit" list="list_unit" class="caps w-full p-2 text-sm rounded" placeholder="Pilih Unit..." required>
                <datalist id="list_unit"></datalist>
            </div>

            <div class="grid grid-cols-3 gap-2">
                <div><label class="text-xs font-bold">Tarikh</label><input type="date" id="tarikh" class="w-full p-2 text-sm rounded"></div>
                <div><label class="text-xs font-bold">Mula</label><input type="time" id="mula" class="w-full p-2 text-sm rounded"></div>
                <div><label class="text-xs font-bold">Tamat</label><input type="time" id="tamat" class="w-full p-2 text-sm rounded"></div>
            </div>

            <div class="grid grid-cols-2 gap-3">
                <div><label class="text-xs font-bold">Tempat</label><input type="text" id="tempat" class="caps w-full p-2 text-sm rounded"></div>
                <div>
                    <label class="text-xs font-bold">Kehadiran</label>
                    <div class="flex gap-1">
                        <input type="number" id="hadir" class="w-full p-2 text-sm rounded" placeholder="Hadir">
                        <input type="number" id="penuh" class="w-full p-2 text-sm rounded" placeholder="Penuh">
                    </div>
                </div>
            </div>

            <div class="bg-emerald-50 p-2 rounded border border-emerald-100">
                <label class="text-xs font-bold text-emerald-800">Guru Penasihat</label>
                <div id="guru_box" class="space-y-1 mt-1">
                    <div class="flex gap-1">
                        <input type="text" list="list_guru" class="inp-guru caps w-full p-2 text-sm rounded border" placeholder="Nama Guru">
                        <button type="button" onclick="addGuru()" class="bg-emerald-600 text-white px-3 rounded font-bold">+</button>
                    </div>
                </div>
                <datalist id="list_guru"></datalist>
            </div>

            <div>
                <label class="text-xs font-bold text-gray-700">Aktiviti (Wajib 4)</label>
                <div class="space-y-1 mt-1">
                    <input type="text" id="a1" class="w-full p-2 text-sm rounded border" placeholder="1.">
                    <input type="text" id="a2" class="w-full p-2 text-sm rounded border" placeholder="2.">
                    <input type="text" id="a3" class="w-full p-2 text-sm rounded border" placeholder="3.">
                    <input type="text" id="a4" class="w-full p-2 text-sm rounded border" placeholder="4.">
                </div>
            </div>

            <div>
                <label class="text-xs font-bold text-gray-700">Gambar (Max 3)</label>
                <div class="grid grid-cols-3 gap-2 mt-1">
                    <input type="file" accept="image/*" onchange="loadImg(this,0)" class="text-xs">
                    <input type="file" accept="image/*" onchange="loadImg(this,1)" class="text-xs">
                    <input type="file" accept="image/*" onchange="loadImg(this,2)" class="text-xs">
                </div>
            </div>

            <div>
                <label class="text-xs font-bold text-gray-700">Disediakan Oleh</label>
                <input type="text" id="penyedia" list="list_guru" class="caps w-full p-2 text-sm rounded">
            </div>

            <button type="button" onclick="makePDF()" class="w-full bg-emerald-700 hover:bg-emerald-800 text-white font-bold py-3 rounded shadow mt-2">
                JANA PDF (A4 FIT)
            </button>
        </form>
    </div>

    <div class="hidden-container">
        <div id="pdf-content">
            
            <table class="header-table">
                <tr>
                    <td align="center" style="padding-bottom: 5px;">
                        <img src="https://i.ibb.co/xKSj5N9w/Logo-SKSP-01.png" style="height: 70px;">
                        <div class="header-text">
                            <h2>SEKOLAH KEBANGSAAN SERI PULEH</h2>
                            <h3 id="p_jenis">LAPORAN AKTIVITI KOKURIKULUM</h3>
                        </div>
                    </td>
                </tr>
            </table>

            <table class="info-table">
                <tr><td class="bg-gray">TAHUN</td><td id="p_tahun"></td></tr>
                <tr><td class="bg-gray">UNIT / KELAB</td><td id="p_unit" style="font-weight:bold;"></td></tr>
                <tr><td class="bg-gray">TARIKH / MASA</td><td id="p_tarikh"></td></tr>
                <tr><td class="bg-gray">TEMPAT</td><td id="p_tempat"></td></tr>
                <tr><td class="bg-gray">KEHADIRAN</td><td id="p_hadir"></td></tr>
                <tr><td class="bg-gray">GURU PENASIHAT</td><td id="p_guru"></td></tr>
            </table>

            <div class="section-title">RINGKASAN AKTIVITI:</div>
            <table class="act-table">
                <tr><td id="p_a1"></td></tr>
                <tr><td id="p_a2"></td></tr>
                <tr><td id="p_a3"></td></tr>
                <tr><td id="p_a4"></td></tr>
            </table>

            <div class="img-header">GAMBAR AKTIVITI</div>
            <table class="img-table">
                <tr>
                    <td id="img_td_0"></td>
                    <td id="img_td_1" style="border-left: none; border-right: none;"></td>
                    <td id="img_td_2"></td>
                </tr>
            </table>

            <div class="footer-div">
                <p>Disediakan oleh,</p>
                <div class="sign-box">
                    <p style="font-weight: bold; margin: 0;" id="p_penyedia"></p>
                    <p style="margin: 0;">Guru Penasihat</p>
                    <p style="margin: 0; font-weight: bold;" id="p_unit_bawah"></p>
                </div>
            </div>

        </div>
    </div>

    <script>
        // DATA
        const dbUnit = {
            "LAPORAN UNIT BERUNIFORM": ["PERSEKUTUAN PENGAKAP MALAYSIA (PENGAKAP KANAK-KANAK)", "PERSEKUTUAN PENGAKAP MALAYSIA (PENGAKAP KANAK-KANAK PPKI)", "TUNAS KADET REMAJA", "PERGERAKAN PUTERI ISLAM MALAYSIA"],
            "LAPORAN RUMAH SUKAN": ["RUMAH BUANA", "RUMAH SURIA", "RUMAH PURNAMA", "RUMAH SEGARA"],
            "LAPORAN KELAB & PERSATUAN": ["PERSATUAN BAHASA", "PERSATUAN STEM", "PERSATUAN AGAMA ISLAM DAN BAHASA ARAB", "KELAB DOKTOR MUDA", "KELAB SENI TARI", "KELAB MEDIA", "KELAB PERTANIAN PPKI"],
            "LAPORAN SUKAN & PERMAINAN": ["KELAB BOLA SEPAK", "KELAB BOLA JARING", "KELAB BADMINTON", "KELAB CATUR", "KELAB SEPAK TAKRAW", "KELAB BOLING PADANG PPKI"]
        };
        const dbGuru = ["SARDI BIN HASSHIM", "AYU SARAH BINTI ABDULLAH", "MASKOR BIN OSMAN", "ARNIZA BINTI ATAN", "MUHAMMAD AIMAN SYAFIQ BIN ABDUL RAHMAN", "HANAPIAH BINTI TAHERAN", "RINI BINTI YUNUS", "HAZLEYN BT. RAHMAT", "SITI NOR FAZIDAH BINTI TAHIR", "MUHD RIDHWAN BIN SANDONG", "AHMAD HAWAZAN BIN KHOILED", "NUR FARIHIN BINTI MUHAMAD YUSOF", "SHARIFAH BINTI KATMIN", "AMAR ARIFF BIN MOHAMAD HATTA", "ASPRINAH BINTI ABU", "SHAHROM BIN SUKINI", "KAMARUL ARIFFIN BIN RAHMAT", "NOR AISAH BINTI JAIS", "SITI FATIMAH BINTI BAHAR", "SITI NURWAFIYZA BINTI MASRUKIN", "VILMA FARHA BINTI MD AFFINDI", "HIDAYATI BINTI MARNO @ MOHD NOR", "FATIMAH BINTI MASRAN", "SAMIAH BINTI SEKAN", "FATIN ATHIRAH BINTI MAT YUSOFF", "MOHD ROFIZEN BIN IBRAHIM", "MUHAMMAD RAJIE BIN MAHADI", "MOHAMAD KHAIRUL ANUAR BIN MOHD YUSOF", "RAHAYU BINTI MOHD JALIL", "ZAHARIAH BINTI SAMADUN", "NAZIHAH IZYAN BINTI AYUB", "NURAZIAH BINTI BAHROM", "MUHAMMAD HAMIZI BIN MOHD SAID", "MOHD.NAZID BIN HARON", "MASITAH BINTI MEOR HUSSIN", "NOR ASHIKIN BINTI RAMLI", "ZAILATI BT ALI", "NOOR HAZURA BINTI HAMDAN", "SITI RIFA BINTI MOHD SAIM"];

        const gList = document.getElementById('list_guru');
        dbGuru.forEach(g => gList.innerHTML += `<option value="${g}">`);
        updateUnits();

        function updateUnits(){
            const cat = document.getElementById('jenis').value;
            const list = document.getElementById('list_unit');
            list.innerHTML = "";
            document.getElementById('unit').value = "";
            if(dbUnit[cat]) dbUnit[cat].forEach(u => list.innerHTML += `<option value="${u}">`);
        }

        let rawImgs = [null, null, null];
        function loadImg(el, i){
            if(el.files[0]){
                const r = new FileReader();
                r.onload = e => rawImgs[i] = e.target.result;
                r.readAsDataURL(el.files[0]);
            }
        }

        function addGuru(){
            const d = document.createElement('div');
            d.className = "flex gap-1";
            d.innerHTML = `<input type="text" list="list_guru" class="inp-guru caps w-full p-2 text-sm rounded border"><button type="button" onclick="this.parentElement.remove()" class="bg-red-500 text-white px-3 rounded">-</button>`;
            document.getElementById('guru_box').appendChild(d);
        }

        function makePDF() {
            const unitVal = document.getElementById('unit').value.toUpperCase();
            if(!unitVal) return alert("Sila isi Nama Unit!");

            // ISI DATA
            document.getElementById('p_tahun').innerText = document.getElementById('tahun').value;
            document.getElementById('p_jenis').innerText = document.getElementById('jenis').value;
            document.getElementById('p_unit').innerText = unitVal;
            const tm = document.getElementById('mula').value;
            const tt = document.getElementById('tamat').value;
            document.getElementById('p_tarikh').innerText = `${document.getElementById('tarikh').value}  (${tm} - ${tt})`;
            document.getElementById('p_tempat').innerText = document.getElementById('tempat').value.toUpperCase();
            document.getElementById('p_hadir').innerText = `${document.getElementById('hadir').value} / ${document.getElementById('penuh').value}`;
            
            let gs = [];
            document.querySelectorAll('.inp-guru').forEach(i => { if(i.value) gs.push(i.value) });
            document.getElementById('p_guru').innerText = gs.join(", ");

            document.getElementById('p_a1').innerText = "1. " + document.getElementById('a1').value;
            document.getElementById('p_a2').innerText = "2. " + document.getElementById('a2').value;
            document.getElementById('p_a3').innerText = "3. " + document.getElementById('a3').value;
            document.getElementById('p_a4').innerText = "4. " + document.getElementById('a4').value;
            
            document.getElementById('p_penyedia').innerText = document.getElementById('penyedia').value.toUpperCase();
            document.getElementById('p_unit_bawah').innerText = unitVal;

            rawImgs.forEach((src, i) => {
                const cell = document.getElementById(`img_td_${i}`);
                cell.innerHTML = src ? `<img src="${src}">` : `<span style="color:#ccc; font-size:8pt;">TIADA GAMBAR</span>`;
            });

            // GENERATE - SETTINGS PENTING
            const container = document.querySelector('.hidden-container');
            container.style.visibility = 'visible';
            const elem = document.getElementById('pdf-content');
            
            const opt = {
                margin: 0,
                filename: `Laporan_${unitVal.replace(/\s/g,'_')}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { 
                    scale: 2, 
                    useCORS: true,
                    scrollY: 0,
                    windowWidth: 1200 // WAJIB ADA UNTUK MOBILE
                },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(elem).save().then(() => {
                container.style.visibility = 'hidden';
            });
        }
    </script>
</body>
</html>
